{# agent_py.j2 #}
# This file is auto-generated by the ADK code generator.
# Do not edit this file directly.

from google.adk.agents import LlmAgent, SequentialAgent
from google.genai.types import GenerateContentConfig
from . import tools

# --- Model Configurations ---
MODEL_CONFIG_MAP = {
{% for model in models %}
    "{{ model.metadata.name }}": {
        "model": "{{ model.spec.modelId }}",
        {% if model.spec.parameters %}
        "generate_content_config": GenerateContentConfig(
            {% for key, value in model.spec.parameters.items() %}
            {{ key }}={{ value | tojson }},
            {% endfor %}
        ),
        {% endif %}
    },
{% endfor %}
}

# --- Tool Mappings ---
TOOL_FUNCTION_MAP = {
{% for tool in tools %}
    "{{ tool.metadata.name }}": tools.{{ tool.spec.source.functionName }},
{% endfor %}
}

# --- Agent Definitions ---
{% for agent in llm_agents %}
# Definition for LlmAgent: {{ agent.metadata.name }}
{{ agent.metadata.name | replace('-', '_') }} = LlmAgent(
    name="{{ agent.metadata.name }}",
    instruction="""{{ agent.spec.instruction }}""",
    tools=[
        TOOL_FUNCTION_MAP[tool_ref]
        for tool_ref in {{ agent.spec.toolRefs }}
    ],
    {% if agent.spec.output_key %}output_key="{{ agent.spec.output_key }}",{% endif %}
    **MODEL_CONFIG_MAP["{{ agent.spec.modelRef }}"]
)
{% endfor %}
# A dictionary to map all agent names to their Python objects
AGENT_OBJECT_MAP = {
{% for agent in llm_agents %}
    "{{ agent.metadata.name }}": {{ agent.metadata.name | replace('-', '_') }},
{% endfor %}
{% for agent in sequential_agents %}
    "{{ agent.metadata.name }}": None, # Placeholder for sequential agents
{% endfor %}
}
{% for agent in sequential_agents %}
# Definition for SequentialAgent: {{ agent.metadata.name }}
{{ agent.metadata.name | replace('-', '_') }} = SequentialAgent(
    name="{{ agent.metadata.name }}",
    sub_agents=[
        AGENT_OBJECT_MAP[agent_ref]
        for agent_ref in {{ agent.spec.subAgentRefs }}
    ],
)
AGENT_OBJECT_MAP["{{ agent.metadata.name }}"] = {{ agent.metadata.name | replace('-', '_') }}
{% endfor %}

# --- Set the Root Agent ---
root_agent = AGENT_OBJECT_MAP["{{ root_agent_name }}"]